toc: true
title: PowerBI自定义排序对ALL()的影响
date: 2022-02-11 10:52
tags: [PowerBI, Sort, ALL]
description:

---

# PowerBI中自定义排序

PowerBI可以自定义排序，具体如下图

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-30-49.png)

先选中需要自定义排序的列，然后在菜单中选择列工具，再选择按列排序，最后选中实际排序的列。

<!--more-->

# 自定义排序对ALL()的影响

示例数据如下图

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-33-50.png)

分类列依据ID列自定义排序，年月列是时间，数量列是两种分类的具体数量。

现在统计分类1的总量，度量值如下

```
分类1数量.ALL分类 = CALCULATE(SUM('数据'[数量]),'数据'[分类]="分类1")
```

为了便于比较，上面度量值也可以写成

```
分类1数量.ALL分类 = CALCULATE(SUM('数据'[数量]),ALL('数据'[分类]),'数据'[分类]="分类1")
```

这个度量值应该在任何分类中都能显示分类1的总量，但实际结果却如下表

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-41-27.png)

只显示在分类1中，分类2中总量为0，不显示。

如果取消分类列的自定义排序，即按照自身排序，如图

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-43-19.png)

会发现上述度量值能正确显示在两个分类中

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-43-54.png)

# 如何解决

怎么做到既能自定义排序，又有正确的ALL的结果，根据大神Marco Russo[文章](https://www.sqlbi.com/articles/side-effects-in-dax-of-the-sort-by-column-setting/)，需要把两列，自定义排序列和实际排序列，都放在ALL中即可

```
分类1数量.ALL分类和ID = CALCULATE(SUM('数据'[数量]),ALL('数据'[ID],'数据'[分类]),'数据'[分类]="分类1")
```

结果为

![](./PowerBI用自定义排序对ALL()的影响/2022-02-11-11-47-48.png)

